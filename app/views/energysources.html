<!-- TODO: Grab the controller code from building configuration  -->

<!-- Energy sources -->
<div class="box box-primary">
  <div class="box-header with-border">
    <h3 class="box-title">Energy Sources</h3>
  </div>
  <div class="box-body">
    <!-- Button to create a new energy source -->
    <p>
      <button ng-click="buildingConfig.newEnergySource()" class="btn btn-primary"><span class="fa fa-plus"></span> New energy source</button>
    </p>

    <div class="thumbnail" ng-repeat="energySource in buildingConfig.energySources | orderBy: 'hasBeenSaved'">
      <div class="caption">
        <form role="form" name="energySourceForm" novalidate>
          <div class="callout callout-danger" ng-if="energySource.saveError">
            <h4>Energy source save failed</h4>
            <p>There was a problem while saving the energy source. Please try again.</p>
          </div>

          <div class="callout callout-success" ng-if="energySource.saveSuccess">
            <h4>Energy source saved successfully</h4>
            <p>The energy source has been saved successfully.</p>
          </div>

          <div class="form-group" ng-class="{ 'has-error' : energySourceForm.name.$dirty && energySourceForm.name.$invalid}">
            <label for="name">Name</label>
            <p>The name given to the energy source. Used to identify the source in charts or tables.</p>
            <input class="form-control" ng-model="energySource.data.name" name="name" id="name" required>
          </div>

          <div class="form-group">
            <label for="currentSensor">Source Current Sensor</label>
            <p>This is the current sensor that provides the current for this source. Expects values above zero mean charging, and any value below zero is ignored.</p>
            <div sensor-selector charger-allowed="true" other-allowed="true" building="buildingConfig.building" model="energySource.data.currentSensorId"></div>
          </div>

          <div class="form-group" ng-class="{ 'has-error' : energySourceForm.sortIndex.$dirty && energySourceForm.sortIndex.$invalid}">
            <label for="sortIndex">
              Graph sort index
            </label>
            <p>A number that defines the position in the sort order of energy sources. A low number means at the front of the sensor order, a high number means at the button of the sensor order. This is used to define the position of energy sources within graphs.</p>
            <input class="form-control" type="number" ng-model="energySource.data.sortIndex" name="sortIndex" id="sortIndex" required>
          </div>

          <div class="form-group">
            <div class="checkbox">
              <label>
                <input type="checkbox" ng-model="energySource.data.isRenewable">
                Is a renewable energy source
              </label>
            </div>
          </div>

          <div class="form-group">
            <label for="chartColour">Chart colour</label>
            <p>This is the colour to display the source with in graphs.</p>
            <div colour-selector model="energySource.data.chartColour"></div>
          </div>

          <div class="form-group">
            <label for="chartColour">Prediction Type</label>
            <p>This defines the type of prediction model to use. This is used in future state estimations.</p>
            <div prediction-type-selector model="energySource.data.predictionPatternType"></div>
          </div>

          <br>
          <button ng-if="energySource.hasBeenSaved" ng-disabled="energySourceForm.$invalid" type="submit" ng-click="buildingConfig.saveEnergySource(energySource)" class="btn btn-primary">Save</button>

          <button ng-if="!energySource.hasBeenSaved" ng-disabled="energySourceForm.$invalid" type="submit" ng-click="buildingConfig.createEnergySource(energySource)" class="btn btn-primary">Create</button>

          <button ng-click="buildingConfig.deleteEnergySource(energySource)" class="btn btn-danger">Delete</button>
        </form>
      </div>
    </div>
  </div>
</div>
